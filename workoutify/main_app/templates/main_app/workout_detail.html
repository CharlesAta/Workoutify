{% extends 'base.html' %} {% block content %}

<h1>{{ workout.name }}</h1>
<h4>{{ workout.location }}</h4>

<div class="col s6">
    <form id="scheduleForm" method="post">
      {% csrf_token %}
      {{ schedule_form.as_p }}
      <input id="sched-workout-btn" type="submit" class="btn" value="Schedule Workout">
    </form>
    <br>

    <table class="striped">
      <thead>
        <tr><th>Date</th><th>Time</th></tr>
      </thead>
      <tbody>
        {% for schedule in workout.schedules.all %}
          <tr>
            <td>{{schedule.date}}</td>
            <td>{{schedule.time}}</td>
            <td>
              <form method='POST' action="{% url 'delete_schedule' workout.id schedule.id %}">
                {% csrf_token %}
                <button type="submit" class='btn'>Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<hr>
<div class="row">
  <div class="col s6">
    <h3>Current Workout Exercises</h3>
    {% if workout.exercises.count %}
      {% for exercise in workout.exercises.all %}
        <div class="card">
          <div class="card-content">
            <span class="card-title activator grey-text text-darken-4">
               {{ exercise.name }}<i class="material-icons right">more_vert</i>
            </span>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          
          <div class="card-reveal">
            <span class="card-title grey-text text-darken-4">{{ exercise.name }}<i class="material-icons right">close</i></span>
            <p>{{ exercise.description }}</p>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          <div class="card-action">
            <form action="{% url 'unassoc_exercise' workout.id exercise.id %}" method="POST">
              {% csrf_token %}
              <button type='submit' class='btn'>Remove Exercise</button>
            </form>
          </div>
        </div> 
      {% endfor %}
    {% else %}
      <h5>No Exercises :(</h5>
    {% endif %}
  </div>
  <!-- Available exercises will come after this line -->

  <div class="col s6">
    <h3>All available Exercises</h3>
    {% if exercises.count %}
      {% for exercise in exercises.all %}
        <div class="card">
          <div class="card-content">
            <span class="card-title activator grey-text text-darken-4">
               {{ exercise.name }}<i class="material-icons right">more_vert</i>
            </span>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          
          <div class="card-reveal">
            <span class="card-title grey-text text-darken-4">{{ exercise.name }}<i class="material-icons right">close</i></span>
            <p>{{ exercise.description }}</p>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          <div class="card-action">
            <form action="{% url 'assoc_exercise' workout.id exercise.id %}" method="POST">
              {% csrf_token %}
              <button type='submit' class='btn'>Add Exercise</button>
            </form>
          </div>

        </div> 
      {% endfor %}
    {% else %}
      <h5>All Exercises have been added to workout: {{ workout.name }}</h5>
    {% endif %}
  </div>
</div>

<a href="{% url 'workouts_delete' workout.id %}">Delete</a>
<a href="{% url 'workouts_update' workout.id %}">Edit</a>

{% endblock %}
{% block javascript %}
<script>
let dateEl = document.getElementById('id_date');
M.Datepicker.init(dateEl, {
format: 'yyyy-mm-dd',
defaultDate: new Date(),
setDefaultDate: true,
autoClose: true
});

let timeEl = document.getElementById('id_time');
M.Timepicker.init(timeEl, {
defaultTime: 'now',
});

let schedWorkoutBtn = document.getElementById('sched-workout-btn');

schedWorkoutBtn.addEventListener('click', function() {
    let time = timeEl.value;
    let hours = parseInt(time.slice(0, time.indexOf(':')));
    if (time.endsWith("AM")){
        if (hours === 12){
            hours = 0;
        }
    } else {
        if (hours < 12){
            hours += 12;
        }
    }
    let minutes = time.slice(time.indexOf(':'), time.indexOf(' '));
    let two_four_clock = `${hours}${minutes}`
    timeEl.value = two_four_clock;
})


$(document).ready(function () {
    // catch the form's submit event
    $('#scheduleForm').submit(function () {
        // create an AJAX call
        $.ajax({
            data: $(this).serialize(), // get the form data
            type: $(this).attr('method'), // GET or POST
            url: "{% url 'add_schedule' workout.id %}",
            // on success
            success: function (response) {
                alert("Thankyou for reaching us out " + response.name);
            },
            // on error
            error: function (response) {
                // alert the error if any error occured
                alert(response.responseJSON.errors);
                console.log(response.responseJSON.errors)
            }
        });
        return false;
    });
})
</script>
{% endblock %}