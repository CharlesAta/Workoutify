{% extends 'base.html' %} {% block content %}

<h1>{{ workout.name }}</h1>
<h4>{{ workout.location }}</h4>

<div class="col s6">
    <form id="scheduleForm" method="post" data-url="{% url 'add_schedule' workout.id %}">
      {% csrf_token %}
      {{ schedule_form.as_p }}
      <button id="sched-workout-btn" type="button" class="btn"> Schedule Workout</button>
    </form>
    <br>

    <table class="striped">
      <thead>
        <tr><th>Date</th><th>Time</th></tr>
      </thead>
      <tbody>
        {% for schedule in workout.schedules.all %}
          <tr>
            <td>{{schedule.date}}</td>
            <td>{{schedule.time}}</td>
            <td>
              <form method='POST' action="{% url 'delete_schedule' workout.id schedule.id %}">
                {% csrf_token %}
                <button type="submit" class='btn'>Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<hr>
<div class="row">
  <div class="col s6">
    <h3>Current Workout Exercises</h3>
    {% if workout.exercises.count %}
      {% for exercise in workout.exercises.all %}
        <div class="card">
          <div class="card-content">
            <span class="card-title activator grey-text text-darken-4">
               {{ exercise.name }}<i class="material-icons right">more_vert</i>
            </span>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          
          <div class="card-reveal">
            <span class="card-title grey-text text-darken-4">{{ exercise.name }}<i class="material-icons right">close</i></span>
            <p>{{ exercise.description }}</p>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          <div class="card-action">
            <form action="{% url 'unassoc_exercise' workout.id exercise.id %}" method="POST">
              {% csrf_token %}
              <button type='submit' class='btn'>Remove Exercise</button>
            </form>
          </div>
        </div> 
      {% endfor %}
    {% else %}
      <h5>No Exercises :(</h5>
    {% endif %}
  </div>
  <!-- Available exercises will come after this line -->

  <div class="col s6">
    <h3>All available Exercises</h3>
    {% if exercises.count %}
      {% for exercise in exercises.all %}
        <div class="card">
          <div class="card-content">
            <span class="card-title activator grey-text text-darken-4">
               {{ exercise.name }}<i class="material-icons right">more_vert</i>
            </span>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          
          <div class="card-reveal">
            <span class="card-title grey-text text-darken-4">{{ exercise.name }}<i class="material-icons right">close</i></span>
            <p>{{ exercise.description }}</p>
            <p>{{ exercise.sets }} sets</p>
            <p>{{ exercise.reps }} reps</p>
          </div>
          <div class="card-action">
            <form action="{% url 'assoc_exercise' workout.id exercise.id %}" method="POST">
              {% csrf_token %}
              <button type='submit' class='btn'>Add Exercise</button>
            </form>
          </div>

        </div> 
      {% endfor %}
    {% else %}
      <h5>All Exercises have been added to workout: {{ workout.name }}</h5>
    {% endif %}
  </div>
</div>

<a href="{% url 'workouts_delete' workout.id %}">Delete</a>
<a href="{% url 'workouts_update' workout.id %}">Edit</a>

<script>
$(document).ready(function () {
    // catch the form's submit event
    $('#sched-workout-btn').submit(function () {
        // create an AJAX call

        let serializedData = $("#scheduleForm").serialize();


        console.log(serializedData)

        // $.ajax({
        //     data: $(this).serialize(), // get the form data
        //     type: 'POST', // GET or POST
        //     url: "{% url 'add_schedule' workout.id %}",
        //     // on success
        //     success: function (response) {
        //         // on successfull creating object
        //         // 1. clear the form.
        //         $("#scheduleForm").trigger('reset');

        //         // display the newly friend to table.
        //         let instance = JSON.parse(response["instance"]);
        //         console.log(instance)
        //         let fields = instance[0]["fields"];
        //         console.log(fields)
        //         $("#workout-schedule tbody").prepend(
        //             `<tr>
        //             <td>${fields["date"]||""}</td>
        //             <td>${fields["time"]||""}</td>
        //             </tr>`
        //         )
        //     },
        //     error: function (response) {
        //         // alert the error if any error occured
        //         alert(response["responseJSON"]["error"]);
        //     }
        // });
        // return false;
    });
})
</script>
{% endblock %}